<div class="oem-test-container">
  <h1>OEM API Test / Health Check</h1>
  <p class="subtitle">Operations & Execution Management Module</p>

  <div class="test-section">
    <div class="test-header">
      <h2>üîå Connection Test</h2>
      <button class="btn btn-primary" (click)="checkHealth()" [disabled]="loading">
        {{ loading ? 'Testing...' : 'Test Connection' }}
      </button>
    </div>

    <div *ngIf="loading" class="loading-message">
      <div class="spinner"></div>
      <p>Connecting to OEM API...</p>
    </div>

    <div *ngIf="error" class="alert alert-error">
      <strong>‚ùå Connection Failed</strong>
      <p>{{ error }}</p>
      <div class="error-details">
        <p><strong>Troubleshooting:</strong></p>
        <ul>
          <li>Ensure OEM API is running: <code>cd OemApi && dotnet run</code></li>
          <li>Verify the service is listening on <code>http://localhost:5003</code></li>
          <li>Check that your JWT token is valid (try logging out and back in)</li>
          <li>Verify you have the <strong>LogisticOperator</strong> role</li>
        </ul>
      </div>
    </div>

    <div *ngIf="healthStatus" class="health-status success">
      <div class="status-header">
        <h3>‚úÖ Connection Successful</h3>
        <span class="status-badge">{{ healthStatus.status }}</span>
      </div>

      <div class="info-grid">
        <div class="info-card">
          <div class="info-label">Service</div>
          <div class="info-value">{{ healthStatus.service }}</div>
        </div>

        <div class="info-card">
          <div class="info-label">Server Time (UTC)</div>
          <div class="info-value">{{ healthStatus.utcNow | date : 'medium' }}</div>
        </div>

        <div class="info-card">
          <div class="info-label">User ID</div>
          <div class="info-value">{{ healthStatus.user.id }}</div>
        </div>

        <div class="info-card">
          <div class="info-label">Username</div>
          <div class="info-value">{{ healthStatus.user.username }}</div>
        </div>

        <div class="info-card">
          <div class="info-label">Email</div>
          <div class="info-value">{{ healthStatus.user.email }}</div>
        </div>

        <div class="info-card">
          <div class="info-label">Roles</div>
          <div class="info-value">
            <span class="role-badge" *ngFor="let role of healthStatus.user.roles">
              {{ role }}
            </span>
          </div>
        </div>
      </div>

      <div class="success-message">
        <p>üéâ <strong>Integration Working!</strong></p>
        <p>
          The OEM API is properly configured with authentication, authorization, and CORS. You can
          now proceed with implementing Operation Plan persistence.
        </p>
      </div>
    </div>
  </div>

  <div class="info-section">
    <h3>üìã About OEM Module</h3>
    <p>The <strong>Operations & Execution Management (OEM)</strong> module is responsible for:</p>
    <ul>
      <li>Storing and managing Operation Plans generated by the Scheduling Module</li>
      <li>Tracking execution status of planned vessel operations</li>
      <li>Providing historical data and analytics</li>
      <li>Managing operational workflows and approvals</li>
    </ul>
    <p>
      <strong>Current Status:</strong> MVP - Health check endpoint only. Operation Plan persistence
      will be added next.
    </p>
  </div>
</div>
